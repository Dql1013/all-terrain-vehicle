# 智能小车项目 - 海信杯比赛

## 项目概述

这是一个基于STM32F103C8微控制器的智能小车项目，专为"海信杯"比赛设计。该项目实现了自动循迹、电机控制、路径规划等功能，能够识别并通过比赛场地中的各种路况（如十字路、弯道、窄桥、减速带等）。

## 硬件组成

- **主控芯片**：STM32F103C8（ARM Cortex-M3）
- **电机驱动**：TB6612FNG双电机驱动芯片
- **传感器**：8路红外循迹传感器
- **反馈系统**：2路编码器（用于电机速度检测）
- **显示模块**：OLED显示屏（用于调试信息展示）
- **电源系统**：适配直流电机的电源模块

## 功能特点

- **自动循迹**：通过8路红外传感器检测黑色轨迹，支持识别直行、左转、右转、十字路口等多种路况
- **PID速度控制**：利用编码器反馈实现精确的电机速度控制
- **路径规划**：通过黑区计数实现对比赛场地不同路段的识别和针对性控制
- **OLED状态显示**：实时显示传感器状态、电机速度、当前路径状态等信息
- **多种运动模式**：前进、后退、左转、右转、90度转向等多种运动控制

## 项目结构

```
├── Hardware/        # 硬件驱动模块
│   ├── Encoder.c/h  # 编码器驱动
│   ├── Key.c/h      # 按键处理
│   ├── OLED.c/h     # OLED显示驱动
│   ├── PID.c/h      # PID控制算法
│   ├── TB6612.c/h   # 电机驱动控制
│   ├── Tracks.c/h   # 循迹传感器处理
│   └── UserTasks.c/h # 用户任务处理
├── System/          # 系统核心模块
│   ├── Delay.c/h    # 延时函数
│   ├── GPIO.c/h     # GPIO配置
│   ├── SYS.c/h      # 系统初始化和主功能
│   └── Timer.c/h    # 定时器配置
├── User/            # 用户应用层
│   ├── main.c       # 程序入口
│   └── stm32f10x_it.c/h # 中断处理
├── Library/         # STM32标准库
├── Start/           # 启动文件和系统配置
├── Project.uvprojx  # Keil项目文件
└── README.md        # 项目说明文档
```

## 主要模块说明

### 1. 循迹模块 (Tracks.c/h)
- 8路红外传感器状态读取和处理
- 轨迹状态识别（直行、左转、右转、十字路口等）
- 轨迹偏差计算（用于PID控制）
- 黑区检测和计数（用于路径规划）

### 2. 电机控制模块 (TB6612.c/h)
- 电机方向控制（前进、后退、停止）
- PWM速度调节
- 各种运动模式实现（直行、转向等）

### 3. PID控制模块 (PID.c/h)
- 基于编码器反馈的速度闭环控制
- 左右电机独立PID参数调节

### 4. 显示模块 (OLED.c/h)
- 传感器状态显示
- 电机速度显示
- 路径状态显示
- 调试信息输出

### 5. 系统控制模块 (SYS.c/h)
- 系统初始化和外设配置
- 主控制逻辑实现
- 路径规划和任务调度

## 硬件接线说明

### 电机驱动 (TB6612)
- PWMA --- PA2
- AIN2 --- PB15
- AIN1 --- PB14
- BIN1 --- PB13
- BIN2 --- PB12
- PWMB --- PA3

### 循迹传感器
- 传感器1 --- PA8
- 传感器2 --- PA9
- 传感器3 --- PA10
- 传感器4 --- PA11
- 传感器5 --- PB0
- 传感器6 --- PB1
- 传感器7 --- PB10
- 传感器8 --- PB11

### OLED显示
- OLED_W_D0 --- PA1
- OLED_W_D1 --- PA0
- OLED_W_RES--- PC15
- OLED_W_DC --- PC14
- OLED_W_CS --- PC13

## 使用说明

1. 使用Keil uVision5打开`Project.uvprojx`文件
2. 根据实际硬件连接情况，调整相关引脚定义和参数
3. 编译并烧录程序到STM32F103C8开发板
4. 将开发板安装到小车上，确保所有硬件连接正确
5. 上电后，小车将自动开始循迹运行

## 调试提示

- 通过OLED显示屏可以查看实时的传感器状态和系统信息
- 可在`SYS.c`中的`haixinbei()`函数中调整路径规划算法
- 根据实际路况，可以调整`Tracks.c`中的传感器阈值和权重参数
- 电机速度和PID参数可在相应模块中进行优化调整

## 更新日志

- 2024-10-1: 项目初始化，添加基本框架
- 2024-10-5: 实现基本循迹功能
- 2024-10-15: 优化系统初始化，整合所有外设初始化
- 2024-10-16: 完善SYS模块，集成所有外设功能
- 2024-11-28: 新增路径规划算法

## 注意事项

1. 确保电源电压稳定，以保证电机和传感器正常工作
2. 循迹传感器需要根据实际场地进行阈值校准
3. 电机速度和PID参数需要根据实际小车特性进行调整
4. 在调试过程中，建议先在平坦路面上测试基本功能

## 许可证
项目归属SHUSHU(戴启霖)
本项目仅供学习和比赛使用，请勿用于商业用途。